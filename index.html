<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="style.css">
</head> 
<body>
  <h1>Emoji Painter</h1>
  <p>Draw an image using emoji</p>
  <p class="emojiCanvas">EMPTY_CANVAS</p>
  <br/>
  <script>
    let mouseButtonState = 0;
    const EMOJI_CANVAS_DIMENSIONS = {
      width : 80,
      height : 30
    }

    class EmojiBrush {
      constructor() {
        this._brushInt = 128515;
      }

      get brushInt() {
        return this._brushInt;
      }
      get html() {
        return '&#' + this.brushInt;
      }
      set brushInt(brushInt) {
        this._brushInt = brushInt;
      }
    }

    let brush = new EmojiBrush();

    class EmojiCanvas {
      constructor(width, height, canvasElement) {
        this.canvasElement = canvasElement;
        let y = [];
        for (let i=0; i<height; i++) {
          y.push('&#128515');
        }
        this.matrix = [];
        for (let i=0; i<width; i++) {
          this.matrix.push(y.slice());
        }
        this.updateCanvasElement();
      }

      get width() {
        return this.matrix.length;
      }
      get height() {
        return this.matrix[0].length;
      }
      getCanvasElement() {
        return this.canvasElement;
      }

      /**
      * @param {string, int, int} Hex code of emoji,
      * x-y coordinates
      */
      setPixel(hexEmoji, x, y) {
        this.matrix[x][y] = hexEmoji;
        this.updateCanvasElement();
      }

      updateCanvasElement() {
        let outputString = '';
        for (let i=0; i<this.height; i++) {
          for (let j=0; j<this.width; j++) {
            outputString += this.matrix[j][i];
          }
          outputString += '<br/>'
        }
        this.canvasElement.innerHTML = outputString;
      }
    }

    let emojiCanvas = new EmojiCanvas(EMOJI_CANVAS_DIMENSIONS.width, EMOJI_CANVAS_DIMENSIONS.height, document.getElementsByClassName("emojiCanvas")[0]);

    let handleMousemove = (event) => {
      let canvasElement = emojiCanvas.canvasElement;
      let xRatio = emojiCanvas.width / canvasElement.getBoundingClientRect().width;
      let yRatio = emojiCanvas.height / canvasElement.getBoundingClientRect().height;
      if (mouseButtonState % 2 == 1) {
        emojiCanvas.setPixel(brush.html, Math.floor(event.x*xRatio - 0.5), Math.floor(event.y*yRatio - canvasElement.getBoundingClientRect().top*yRatio));
      }
    };
    document.addEventListener('mousemove', handleMousemove);

    let handleMousewheel = (event) => {
      brush.brushInt += event.deltaY;
      return false;
    }
    let canvasElement = emojiCanvas.canvasElement;
    canvasElement.addEventListener('wheel', handleMousewheel);

    let handleMouseDown = (event) => {
      mouseButtonState = event.buttons;
    }
    document.addEventListener('mousedown', handleMouseDown);

    let handleMouseUp = (event) => {
      mouseButtonState = event.buttons;
    }
    document.addEventListener('mouseup', handleMouseUp);
  </script>
