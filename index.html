<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="style.css">
</head> 
<body>
  <h1>Emoji Painter</h1>
  <p>Draw an image using emoji<span class='brush'></span></p>
  <p class="emojiCanvas">EMPTY_CANVAS</p>
  <script>
    let emojiCanvasElement = document.getElementsByClassName("emojiCanvas")[0];
    let brushCanvasElement = document.getElementsByClassName("brush")[0];
    let mouseButtonState = 0;

    class EmojiBrush {
      constructor() {
        this._brushInt = 128515;
      }

      get brushInt() {
        return this._brushInt;
      }
      get html() {
        return '&#' + this.brushInt;
      }
      set brushInt(brushInt) {
        this._brushInt = brushInt;
      }
    }

    let brush = new EmojiBrush();
    brushCanvasElement.innerHTML = ' ' + brush.html;

    class EmojiCanvas {
      constructor(canvasElement) {
        this.canvasElement = canvasElement;
        this.matrix = [['&#128515']];
        this.updateCanvasElement();
        let _canvasElement = this.canvasElement;
        let xRatio = Math.floor(_canvasElement.parentElement.clientWidth / _canvasElement.getBoundingClientRect().width);
        let yRatio = Math.floor((_canvasElement.parentElement.clientHeight - _canvasElement.getBoundingClientRect().top) / _canvasElement.getBoundingClientRect().height);

        let y = [];
        this.matrix = [];
        for (let i=0; i<yRatio; i++) {
          y.push('&#128515');
        }
        for (let i=0; i<xRatio; i++) {
          this.matrix.push(y.slice());
        }
        this.updateCanvasElement();
      }

      get width() {
        return this.matrix.length;
      }
      get height() {
        return this.matrix[0].length;
      }
      getCanvasElement() {
        return this.canvasElement;
      }

      /**
      * @param {string, int, int} Hex code of emoji,
      * x-y coordinates
      */
      setPixel(hexEmoji, x, y) {
        this.matrix[x][y] = hexEmoji;
        this.updateCanvasElement();
      }

      updateCanvasElement() {
        let outputString = '';
        for (let i=0; i<this.height; i++) {
          for (let j=0; j<this.width; j++) {
            outputString += this.matrix[j][i];
          }
          outputString += '<br/>'
        }
        this.canvasElement.innerHTML = outputString;
      }
    }

    let emojiCanvas = new EmojiCanvas(emojiCanvasElement);

    let xRatio = emojiCanvas.width / emojiCanvas.canvasElement.getBoundingClientRect().width;
    let yRatio = emojiCanvas.height / emojiCanvas.canvasElement.getBoundingClientRect().height;

    let handleMousemove = (event) => {
      if (mouseButtonState % 2 == 1) {
        emojiCanvas.setPixel(brush.html, Math.floor(event.x*xRatio - 0.5), Math.floor(event.y*yRatio - emojiCanvas.canvasElement.getBoundingClientRect().top*yRatio));
      }
    };
    document.addEventListener('mousemove', handleMousemove);

    let handleMousewheel = (event) => {
      brush.brushInt += event.deltaY;
      brushCanvasElement.innerHTML = ' ' + brush.html;
      return false;
    }
    let canvasElement = emojiCanvas.canvasElement;
    canvasElement.addEventListener('wheel', handleMousewheel);

    let handleMouseDown = (event) => {
      mouseButtonState = event.buttons;
      let canvasElement = emojiCanvas.canvasElement;
      emojiCanvas.setPixel(brush.html, Math.floor(event.x*xRatio - 0.5), Math.floor(event.y*yRatio - canvasElement.getBoundingClientRect().top*yRatio));
    }
    document.addEventListener('mousedown', handleMouseDown);

    let handleMouseUp = (event) => {
      mouseButtonState = event.buttons;
    }
    document.addEventListener('mouseup', handleMouseUp);
  </script>
